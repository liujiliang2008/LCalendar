window.LCalendar=(function(){var a=function(){this.gearDate;this.minY=1900;this.minM=1;this.minD=1;this.maxY=2099;this.maxM=12;this.maxD=31};a.prototype={init:function(e){this.type=e.type;this.trigger=document.querySelector(e.trigger);if(this.trigger.getAttribute("data-lcalendar")!=null){var b=this.trigger.getAttribute("data-lcalendar").split(",");var d=b[0].split("-");this.minY=~~d[0];this.minM=~~d[1];this.minD=~~d[2];var c=b[1].split("-");this.maxY=~~c[0];this.maxM=~~c[1];this.maxD=~~c[2]}if(e.minDate){var d=e.minDate.split("-");this.minY=~~d[0];this.minM=~~d[1];this.minD=~~d[2]}if(e.maxDate){var c=e.maxDate.split("-");this.maxY=~~c[0];this.maxM=~~c[1];this.maxD=~~c[2]}this.bindEvent(this.type)},bindEvent:function(e){var f=this;function d(F){f.gearDate=document.createElement("div");f.gearDate.className="gearDate";f.gearDate.innerHTML='<div class="date_ctrl slideInUp">'+'<div class="date_roll_mask">'+'<div class="date_roll">'+"<div>"+'<div class="gear date_yy" data-datetype="date_yy"></div>'+'<div class="date_grid">'+"<div>年</div>"+"</div>"+"</div>"+"<div>"+'<div class="gear date_mm" data-datetype="date_mm"></div>'+'<div class="date_grid">'+"<div>月</div>"+"</div>"+"</div>"+"<div>"+'<div class="gear date_dd" data-datetype="date_dd"></div>'+'<div class="date_grid">'+"<div>日</div>"+"</div>"+"</div>"+"</div>"+'<div class="date_btn_box">'+'<div class="date_btn lcalendar_cancel">取消</div>'+'<div class="date_btn lcalendar_finish">确定</div>'+"</div>"+"</div>"+"</div>";document.body.appendChild(f.gearDate);q();f.gearDate.addEventListener("touchstart",l);var A=f.gearDate.querySelector(".date_ctrl");A.addEventListener("touchstart",function(G){G.stopPropagation();return false});var E=f.gearDate.querySelector(".lcalendar_cancel");E.addEventListener("touchstart",l);var D=f.gearDate.querySelector(".lcalendar_finish");D.addEventListener("touchstart",r);var B=f.gearDate.querySelector(".date_yy");var z=f.gearDate.querySelector(".date_mm");var C=f.gearDate.querySelector(".date_dd");B.addEventListener("touchstart",c);z.addEventListener("touchstart",c);C.addEventListener("touchstart",c);B.addEventListener("touchmove",w);z.addEventListener("touchmove",w);C.addEventListener("touchmove",w);B.addEventListener("touchend",j);z.addEventListener("touchend",j);C.addEventListener("touchend",j)}function q(){var z=h(f.trigger.value);var A={yy:z.getFullYear(),mm:z.getMonth(),dd:z.getDate()-1};if(/^\d{4}-\d{1,2}-\d{1,2}$/.test(f.trigger.value)){rs=f.trigger.value.match(/(^|-)\d{1,4}/g);A.yy=rs[0]-f.minY;A.mm=rs[1].replace(/-/g,"")-1;A.dd=rs[2].replace(/-/g,"")-1}else{A.yy=A.yy-f.minY}f.gearDate.querySelector(".date_yy").setAttribute("val",A.yy);f.gearDate.querySelector(".date_mm").setAttribute("val",A.mm);f.gearDate.querySelector(".date_dd").setAttribute("val",A.dd);x()}function o(E){f.gearDate=document.createElement("div");f.gearDate.className="gearDate";f.gearDate.innerHTML='<div class="date_ctrl slideInUp">'+'<div class="date_roll_mask">'+'<div class="ym_roll">'+"<div>"+'<div class="gear date_yy" data-datetype="date_yy"></div>'+'<div class="date_grid">'+"<div>年</div>"+"</div>"+"</div>"+"<div>"+'<div class="gear date_mm" data-datetype="date_mm"></div>'+'<div class="date_grid">'+"<div>月</div>"+"</div>"+"</div>"+"</div>"+'<div class="date_btn_box">'+'<div class="date_btn lcalendar_cancel">取消</div>'+'<div class="date_btn lcalendar_finish">确定</div>'+"</div>"+"</div>"+"</div>";document.body.appendChild(f.gearDate);n();f.gearDate.addEventListener("touchstart",l);var A=f.gearDate.querySelector(".date_ctrl");A.addEventListener("touchstart",function(F){F.stopPropagation();return false});var D=f.gearDate.querySelector(".lcalendar_cancel");D.addEventListener("touchstart",l);var C=f.gearDate.querySelector(".lcalendar_finish");C.addEventListener("touchstart",s);var B=f.gearDate.querySelector(".date_yy");var z=f.gearDate.querySelector(".date_mm");B.addEventListener("touchstart",c);z.addEventListener("touchstart",c);B.addEventListener("touchmove",w);z.addEventListener("touchmove",w);B.addEventListener("touchend",j);z.addEventListener("touchend",j)}function n(){var z=h(f.trigger.value);var A={yy:z.getFullYear(),mm:z.getMonth()};if(/^\d{4}-\d{1,2}$/.test(f.trigger.value)){rs=f.trigger.value.match(/(^|-)\d{1,4}/g);A.yy=rs[0]-f.minY;A.mm=rs[1].replace(/-/g,"")-1}else{A.yy=A.yy-f.minY}f.gearDate.querySelector(".date_yy").setAttribute("val",A.yy);f.gearDate.querySelector(".date_mm").setAttribute("val",A.mm);x()}function k(F){f.gearDate=document.createElement("div");f.gearDate.className="gearDatetime";f.gearDate.innerHTML='<div class="date_ctrl slideInUp">'+'<div class="date_roll_mask">'+'<div class="datetime_roll">'+"<div>"+'<div class="gear date_yy" data-datetype="date_yy"></div>'+'<div class="date_grid">'+"<div>年</div>"+"</div>"+"</div>"+"<div>"+'<div class="gear date_mm" data-datetype="date_mm"></div>'+'<div class="date_grid">'+"<div>月</div>"+"</div>"+"</div>"+"<div>"+'<div class="gear date_dd" data-datetype="date_dd"></div>'+'<div class="date_grid">'+"<div>日</div>"+"</div>"+"</div>"+"<div>"+'<div class="gear time_hh" data-datetype="time_hh"></div>'+'<div class="date_grid">'+"<div>时</div>"+"</div>"+"</div>"+"<div>"+'<div class="gear time_mm" data-datetype="time_mm"></div>'+'<div class="date_grid">'+"<div>分</div>"+"</div>"+"</div>"+"</div>"+'<div class="date_btn_box">'+'<div class="date_btn lcalendar_cancel">取消</div>'+'<div class="date_btn lcalendar_finish">确定</div>'+"</div>"+"</div>"+"</div>";
document.body.appendChild(f.gearDate);v();f.gearDate.addEventListener("touchstart",l);var B=f.gearDate.querySelector(".date_ctrl");B.addEventListener("touchstart",function(I){I.stopPropagation();return false});var A=f.gearDate.querySelector(".lcalendar_cancel");A.addEventListener("touchstart",l);var H=f.gearDate.querySelector(".lcalendar_finish");H.addEventListener("touchstart",m);var G=f.gearDate.querySelector(".date_yy");var E=f.gearDate.querySelector(".date_mm");var z=f.gearDate.querySelector(".date_dd");var C=f.gearDate.querySelector(".time_hh");var D=f.gearDate.querySelector(".time_mm");G.addEventListener("touchstart",c);E.addEventListener("touchstart",c);z.addEventListener("touchstart",c);C.addEventListener("touchstart",c);D.addEventListener("touchstart",c);G.addEventListener("touchmove",w);E.addEventListener("touchmove",w);z.addEventListener("touchmove",w);C.addEventListener("touchmove",w);D.addEventListener("touchmove",w);G.addEventListener("touchend",j);E.addEventListener("touchend",j);z.addEventListener("touchend",j);C.addEventListener("touchend",j);D.addEventListener("touchend",j)}function v(){var z=h(f.trigger.value);var A={yy:z.getFullYear(),mm:z.getMonth(),dd:z.getDate()-1,hh:z.getHours(),mi:z.getMinutes()};if(/^\d{4}-\d{1,2}-\d{1,2}\s\d{2}:\d{2}$/.test(f.trigger.value)){rs=f.trigger.value.match(/(^|-|\s|:)\d{1,4}/g);A.yy=rs[0]-f.minY;A.mm=rs[1].replace(/-/g,"")-1;A.dd=rs[2].replace(/-/g,"")-1;A.hh=parseInt(rs[3].replace(/\s0?/g,""));A.mi=parseInt(rs[4].replace(/:0?/g,""))}else{A.yy=A.yy-f.minY}f.gearDate.querySelector(".date_yy").setAttribute("val",A.yy);f.gearDate.querySelector(".date_mm").setAttribute("val",A.mm);f.gearDate.querySelector(".date_dd").setAttribute("val",A.dd);x();f.gearDate.querySelector(".time_hh").setAttribute("val",A.hh);f.gearDate.querySelector(".time_mm").setAttribute("val",A.mi);i()}function t(E){f.gearDate=document.createElement("div");f.gearDate.className="gearDate";f.gearDate.innerHTML='<div class="date_ctrl slideInUp">'+'<div class="date_roll_mask">'+'<div class="time_roll">'+"<div>"+'<div class="gear time_hh" data-datetype="time_hh"></div>'+'<div class="date_grid">'+"<div>时</div>"+"</div>"+"</div>"+"<div>"+'<div class="gear time_mm" data-datetype="time_mm"></div>'+'<div class="date_grid">'+"<div>分</div>"+"</div>"+"</div>"+"</div>"+'<div class="date_btn_box">'+'<div class="date_btn lcalendar_cancel">取消</div>'+'<div class="date_btn lcalendar_finish">确定</div>'+"</div>"+"</div>"+"</div>";document.body.appendChild(f.gearDate);g();f.gearDate.addEventListener("touchstart",l);var z=f.gearDate.querySelector(".date_ctrl");z.addEventListener("touchstart",function(F){F.stopPropagation();return false});var C=f.gearDate.querySelector(".lcalendar_cancel");C.addEventListener("touchstart",l);var B=f.gearDate.querySelector(".lcalendar_finish");B.addEventListener("touchstart",y);var A=f.gearDate.querySelector(".time_hh");var D=f.gearDate.querySelector(".time_mm");A.addEventListener("touchstart",c);D.addEventListener("touchstart",c);A.addEventListener("touchmove",w);D.addEventListener("touchmove",w);A.addEventListener("touchend",j);D.addEventListener("touchend",j)}function g(){var A=h(f.trigger.value);var z={hh:A.getHours(),mm:A.getMinutes()};if(/^\d{2}:\d{2}$/.test(f.trigger.value)){rs=f.trigger.value.match(/(^|:)\d{2}/g);z.hh=parseInt(rs[0].replace(/^0?/g,""));z.mm=parseInt(rs[1].replace(/:0?/g,""))}f.gearDate.querySelector(".time_hh").setAttribute("val",z.hh);f.gearDate.querySelector(".time_mm").setAttribute("val",z.mm);i()}function x(){var A=f.maxY-f.minY+1;if(f.gearDate==null){return}var M=f.gearDate.querySelector(".date_yy");var O="";if(M&&M.getAttribute("val")){var D=parseInt(M.getAttribute("val"));for(var B=0;B<=A-1;B++){O+="<div class='tooth'>"+(f.minY+B)+"</div>"}M.innerHTML=O;var K=Math.floor(parseFloat(M.getAttribute("top")));if(!isNaN(K)){K%2==0?(K=K):(K=K+1);K>8&&(K=8);var G=8-(A-1)*2;K<G&&(K=G);M.style["-webkit-transform"]="translate3d(0,"+K+"em,0)";M.setAttribute("top",K+"em");D=Math.abs(K-8)/2;M.setAttribute("val",D)}else{M.style["-webkit-transform"]="translate3d(0,"+(8-D*2)+"em,0)";M.setAttribute("top",8-D*2+"em")}}else{return}var I=f.gearDate.querySelector(".date_mm");if(I&&I.getAttribute("val")){O="";var F=parseInt(I.getAttribute("val"));var J=11;var L=0;if(D==A-1){J=f.maxM-1}if(D==0){L=f.minM-1}for(var B=0;B<J-L+1;B++){O+="<div class='tooth'>"+(L+B+1)+"</div>"}I.innerHTML=O;if(F>J){F=J;I.setAttribute("val",F)}else{if(F<L){F=J;I.setAttribute("val",F)}}I.style["-webkit-transform"]="translate3d(0,"+(8-(F-L)*2)+"em,0)";I.setAttribute("top",8-(F-L)*2+"em")}else{return}var z=f.gearDate.querySelector(".date_dd");if(z&&z.getAttribute("val")){O="";var H=parseInt(z.getAttribute("val"));var E=p(D,F);var N=E-1;var C=0;if(D==A-1&&f.maxM==F+1){N=f.maxD-1}if(D==0&&f.minM==F+1){C=f.minD-1}for(var B=0;B<N-C+1;B++){O+="<div class='tooth'>"+(C+B+1)+"</div>"}z.innerHTML=O;if(H>N){H=N;z.setAttribute("val",H)}else{if(H<C){H=C;z.setAttribute("val",H)}}z.style["-webkit-transform"]="translate3d(0,"+(8-(H-C)*2)+"em,0)";
z.setAttribute("top",8-(H-C)*2+"em")}else{return}}function i(){var A=f.gearDate.querySelector(".time_hh");if(f.gearDate==null){return}if(A&&A.getAttribute("val")){var B="";var E=parseInt(A.getAttribute("val"));for(var C=0;C<=23;C++){B+="<div class='tooth'>"+C+"</div>"}A.innerHTML=B;A.style["-webkit-transform"]="translate3d(0,"+(8-E*2)+"em,0)";A.setAttribute("top",8-E*2+"em")}else{return}var D=f.gearDate.querySelector(".time_mm");if(D&&D.getAttribute("val")){var B="";var z=parseInt(D.getAttribute("val"));for(var C=0;C<=59;C++){B+="<div class='tooth'>"+C+"</div>"}D.innerHTML=B;D.style["-webkit-transform"]="translate3d(0,"+(8-z*2)+"em,0)";D.setAttribute("top",8-z*2+"em")}else{return}}function p(z,A){if(A==1){z+=f.minY;if((z%4==0&&z%100!=0)||(z%400==0&&z%4000!=0)){return 29}else{return 28}}else{if(A==3||A==5||A==8||A==10){return 30}else{return 31}}}function c(B){B.preventDefault();var A=B.target;while(true){if(!A.classList.contains("gear")){A=A.parentElement}else{break}}clearInterval(A["int_"+A.id]);A["old_"+A.id]=B.targetTouches[0].screenY;A["o_t_"+A.id]=(new Date()).getTime();var z=A.getAttribute("top");if(z){A["o_d_"+A.id]=parseFloat(z.replace(/em/g,""))}else{A["o_d_"+A.id]=0}A.style.webkitTransitionDuration=A.style.transitionDuration="0ms"}function w(B){B.preventDefault();var A=B.target;while(true){if(!A.classList.contains("gear")){A=A.parentElement}else{break}}A["new_"+A.id]=B.targetTouches[0].screenY;A["n_t_"+A.id]=(new Date()).getTime();var z=(A["new_"+A.id]-A["old_"+A.id])*30/window.innerHeight;A["pos_"+A.id]=A["o_d_"+A.id]+z;A.style["-webkit-transform"]="translate3d(0,"+A["pos_"+A.id]+"em,0)";A.setAttribute("top",A["pos_"+A.id]+"em");if(B.targetTouches[0].screenY<1){j(B)}}function j(B){B.preventDefault();var A=B.target;while(true){if(!A.classList.contains("gear")){A=A.parentElement}else{break}}var z=(A["new_"+A.id]-A["old_"+A.id])/(A["n_t_"+A.id]-A["o_t_"+A.id]);if(Math.abs(z)<=0.2){A["spd_"+A.id]=(z<0?-0.08:0.08)}else{if(Math.abs(z)<=0.5){A["spd_"+A.id]=(z<0?-0.16:0.16)}else{A["spd_"+A.id]=z/2}}if(!A["new_"+A.id]||!A["n_t_"+A.id]){A["spd_"+A.id]=0}if(!A["pos_"+A.id]){A["pos_"+A.id]=0}u(A)}function u(C){var D=0;var z=false;function B(){C.style.webkitTransitionDuration=C.style.transitionDuration="200ms";z=true}var A=f.maxY-f.minY+1;clearInterval(C["int_"+C.id]);C["int_"+C.id]=setInterval(function(){if(f.gearDate==null){return}var M=C["pos_"+C.id];var H=C["spd_"+C.id]*Math.exp(-0.03*D);M+=H;if(Math.abs(H)>0.1){}else{var N=Math.round(M/2)*2;M=N;B()}if(M>8){M=8;B()}switch(C.dataset.datetype){case"date_yy":var J=8-(A-1)*2;if(M<J){M=J;B()}if(z){var P=Math.abs(M-8)/2;b(C,P);clearInterval(C["int_"+C.id])}break;case"date_mm":var Q=f.gearDate.querySelector(".date_yy");var F=parseInt(Q.getAttribute("val"));var L=11;var O=0;if(F==A-1){L=f.maxM-1}if(F==0){O=f.minM-1}var J=8-(L-O)*2;if(M<J){M=J;B()}if(z){var P=Math.abs(M-8)/2+O;b(C,P);clearInterval(C["int_"+C.id])}break;case"date_dd":var Q=f.gearDate.querySelector(".date_yy");var K=f.gearDate.querySelector(".date_mm");var F=parseInt(Q.getAttribute("val"));var I=parseInt(K.getAttribute("val"));var G=p(F,I);var R=G-1;var E=0;if(F==A-1&&f.maxM==I+1){R=f.maxD-1}if(F==0&&f.minM==I+1){E=f.minD-1}var J=8-(R-E)*2;if(M<J){M=J;B()}if(z){var P=Math.abs(M-8)/2+E;b(C,P);clearInterval(C["int_"+C.id])}break;case"time_hh":if(M<-38){M=-38;B()}if(z){var P=Math.abs(M-8)/2;b(C,P);clearInterval(C["int_"+C.id])}break;case"time_mm":if(M<-110){M=-110;B()}if(z){var P=Math.abs(M-8)/2;b(C,P);clearInterval(C["int_"+C.id])}break;default:}C["pos_"+C.id]=M;C.style["-webkit-transform"]="translate3d(0,"+M+"em,0)";C.setAttribute("top",M+"em");D++},30)}function b(z,A){A=Math.round(A);z.setAttribute("val",A);if(/date/.test(z.dataset.datetype)){x()}else{i()}}function l(A){A.preventDefault();var z;try{z=new CustomEvent("input")}catch(A){z=document.createEvent("Event");z.initEvent("input",true,true)}f.trigger.dispatchEvent(z);document.body.removeChild(f.gearDate);f.gearDate=null}function r(D){var C=f.maxY-f.minY+1;var A=parseInt(Math.round(f.gearDate.querySelector(".date_yy").getAttribute("val")));var z=parseInt(Math.round(f.gearDate.querySelector(".date_mm").getAttribute("val")))+1;z=z>9?z:"0"+z;var B=parseInt(Math.round(f.gearDate.querySelector(".date_dd").getAttribute("val")))+1;B=B>9?B:"0"+B;f.trigger.value=(A%C+f.minY)+"/"+z+"/"+B;l(D)}function s(C){var B=f.maxY-f.minY+1;var A=parseInt(Math.round(f.gearDate.querySelector(".date_yy").getAttribute("val")));var z=parseInt(Math.round(f.gearDate.querySelector(".date_mm").getAttribute("val")))+1;z=z>9?z:"0"+z;f.trigger.value=(A%B+f.minY)+"/"+z;l(C)}function m(F){var D=f.maxY-f.minY+1;var A=parseInt(Math.round(f.gearDate.querySelector(".date_yy").getAttribute("val")));var z=parseInt(Math.round(f.gearDate.querySelector(".date_mm").getAttribute("val")))+1;z=z>9?z:"0"+z;var C=parseInt(Math.round(f.gearDate.querySelector(".date_dd").getAttribute("val")))+1;C=C>9?C:"0"+C;var B=parseInt(Math.round(f.gearDate.querySelector(".time_hh").getAttribute("val")));B=B>9?B:"0"+B;
var E=parseInt(Math.round(f.gearDate.querySelector(".time_mm").getAttribute("val")));E=E>9?E:"0"+E;f.trigger.value=(A%D+f.minY)+"/"+z+"/"+C+" "+(B.length<2?"0":"")+B+(E.length<2?":0":":")+E;l(F)}function y(B){var z=parseInt(Math.round(f.gearDate.querySelector(".time_hh").getAttribute("val")));z=z>9?z:"0"+z;var A=parseInt(Math.round(f.gearDate.querySelector(".time_mm").getAttribute("val")));A=A>9?A:"0"+A;f.trigger.value=(z.length<2?"0":"")+z+(A.length<2?":0":":")+A;l(B)}function h(z){if(null!=z&&""!=z){return new Date(Date.parse(z.replace(/-/g,"/")))}else{return new Date()}}f.trigger.addEventListener("click",{"ym":o,"date":d,"datetime":k,"time":t}[e])}};return a})();